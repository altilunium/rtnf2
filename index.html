<!DOCTYPE html>

<html>
<head>
	<link rel="icon" href="r/logo.png" type="image/x-icon">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>rtnF</title>

<style>
@font-face {
    font-family: 'Noto';
    font-style: normal;
    font-weight: normal;
    src: local('Open Sans Regular'),url('r/noto.woff2') format('woff');
}

html {
  scroll-behavior: smooth;
}

:focus {
	outline: none;
}

a {
	text-decoration: none;
	color: #0983bf;
}


#main-txtbox {

width: 95%;
border: 0px;
padding-left: 3%;
overflow: hidden;
resize: none;
font-family: 'Noto';
color: #1A1A1B;
font-size: 14px;
line-height: 21px;
font-weight: 400;
padding-bottom: 500px;
margin-top: 47px;
max-width: 750px;
}

img {
	max-width: 100%;
	height: auto;

}

</style>



</head>

<body>

<!-- <div><textarea id="main-txtbox" name="body" rows="20" cols="80">{{printf "%s" .Body}}</textarea></div> -->
<div id="main-txtbox" contenteditable></div>


</body>

<script>
        // Helpers for working with indexedDB API.

        var indexedDB = window.indexedDB ||
                        window.webkitIndexedDB ||
                        window.mozIndexedDB;

        function DB(name) {
            this.init = function(version, upgrade, done) {
                console.log('init');
                var openReq = indexedDB.open(name, version);
                openReq.onsuccess = function(e) {
                    var db = e.target.result;
                    // Chrome 23 still has setVersion so don't upgrade
                    // unless the version is still old.
                    if ('setVersion' in db && db.version < version) {
                        var setVerReq = db.setVersion(version);
                        setVerReq.onsuccess = function(e) {
                            console.log('upgrading');
                            upgrade(e.target.result.db);
                            done();
                        };
                    } else {
                        done();
                    }
                };
                openReq.onupgradeneeded = function(e) {
                    // Never gets raised before Chrome 23.
                    console.log('upgrading');
                    upgrade(e.target.result);
                };
                openReq.onerror = function(e) {
                    console.log('init error');
                };
                openReq.onblocked = function(e) {
                    console.log('init blocked');
                };
            };

            this.read = function(stores, fn, done) {
                return this.transaction('readonly', stores, fn, done);
            };

            this.readWrite = function(stores, fn, done) {
                return this.transaction('readwrite', stores, fn, done);
            };

            this.transaction = function(mode, stores, fn, done) {
                var openReq = indexedDB.open(name);
                openReq.onsuccess = function(e) {
                    var db = e.target.result;
                    var tx = db.transaction(stores, mode);
                    tx.oncomplete = function(e) {
                        if (done) {
                            done();
                        }
                    };
                    tx.onabort = function(e) {
                        console.log('tx abort');
                    };
                    tx.onerror = function(e) {
                        console.log('tx error');
                    };
                    fn(tx);
                };
                openReq.onerror = function(e) {
                    console.log('open tx error');
                };
            };
        }

        DB.deleteDatabase = function(name, done) {
            var delReq = indexedDB.deleteDatabase(name);
            delReq.onsuccess = function(e) {
                // Not triggered before Chrome 23.
                done();
            };
            delReq.onerror = function(e) {
                console.log('delete error');
            };
            delReq.onblocked = function(e) {
                console.log('delete blocked');
            };
        };
    </script>


<script>
        // The actual script for this page.

        var databaseName = 'ContactsDB';
        var contactsStoreName = 'contacts';
        var latest = ""
        var contactsDB = new DB(databaseName);

        var contacts = document.getElementById('contacts');

        contactsDB.init(1, function(db) {
            db.createObjectStore(contactsStoreName, {
                autoIncrement: true
            });
        }, function() {
            console.log('ready');

            loadContactsTable();
        });



        function loadContactsTable() {
            contactsDB.read([ contactsStoreName ], function(tx) {
                var cursor = tx.objectStore(contactsStoreName).openCursor();
                cursor.onsuccess = function(e) {
                    if (e.target.result) {
                        addContactToTable(e.target.result.value);
                        e.target.result.continue();
                    }
                };
                cursor.onerror = function(e) {
                    console.log('cursor error');
                };
            });
        }

        function addContactToTable(contact) {
        	
            latest = contact.email
            document.getElementById('main-txtbox').innerHTML = latest;
        }

        var nameInput = "main"
        var emailInput = document.getElementById('main-txtbox');

      


        function save() {
        	var name = "name"
            var email = document.getElementById('main-txtbox').innerHTML
       

            if (email != latest) {
            

            contactsDB.readWrite([ contactsStoreName ], function(tx) {
                var contact = {
                    name: name,
                    email: email
                };

                tx.objectStore(contactsStoreName).put(contact);
               
            }, function() {
                console.log('added');
                latest = email
            });
        	}

        }

        var intervalID = setInterval(function(){save(1)},500)


 var div = document.getElementById('main-txtbox');
setTimeout(function() {
    div.focus();
}, 0);

        

     
        
    </script>
